<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Planning Poker Interactive</title>
<style>
    /* Base reset and body styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif;
    }
    
    body {
        background-color: #f9f9f9;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        color: #333;
    }
    
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: white;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        z-index: 100;
        position: relative;
    }
    
    /* Main container layout */
    .app-container {
        display: flex;
        flex: 1;
        height: calc(100vh - 60px);
        position: relative;
    }
    
    /* Left sidebar for participants */
    .participants-sidebar {
        width: 250px;
        background: white;
        border-right: 1px solid #eaeaea;
        padding: 20px;
        display: flex;
        flex-direction: column;
    }
    
    .participants-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .participants-header h3 {
        font-size: 16px;
        font-weight: 600;
        color: #555;
        margin-left: 10px;
    }
    
    .participants-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        overflow-y: auto;
    }
    
    .participant-item {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: #f5f5f5;
        border-radius: 50px;
        position: relative;
    }
    
    .participant-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #7b68ee;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        margin-right: 10px;
        position: relative;
    }
    
    .participant-avatar.has-voted::after {
        content: '';
        position: absolute;
        right: -2px;
        top: -2px;
        width: 12px;
        height: 12px;
        background: #4caf50;
        border-radius: 50%;
        border: 2px solid #f5f5f5;
    }
    
    .participant-name {
        font-size: 14px;
        font-weight: 500;
    }
    
    .participant-vote {
        position: absolute;
        right: 15px;
        background: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 13px;
        color: #7b68ee;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Main voting area */
    .voting-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        padding: 20px 0;
        position: relative;
    }
    
    .voting-header {
        text-align: center;
        padding: 15px;
        width: 100%;
        max-width: 600px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }
    
    .voting-count {
        font-size: 18px;
        font-weight: 600;
        color: #7b68ee;
    }
    
    .voters-circle {
        position: relative;
        height: 250px;
        width: 250px;
        margin: 0 auto;
    }
    
    .voter-marker {
        position: absolute;
        transform: translate(-50%, -50%);
    }
    
    /* Position voters around the circle using pattern */
    .voter-marker:nth-child(1) { top: 20%; left: 50%; }
    .voter-marker:nth-child(2) { top: 50%; left: 80%; }
    .voter-marker:nth-child(3) { top: 80%; left: 50%; }
    .voter-marker:nth-child(4) { top: 50%; left: 20%; }
    
    .center-instruction {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
        width: 180px;
        font-weight: 500;
    }
    
    .vote-marker {
        position: absolute;
        width: 50px;
        height: 80px;
        background: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: bold;
        color: #7b68ee;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .vote-button {
        background: white;
        border: none;
        border-radius: 6px;
        width: 50px;
        height: 80px;
        font-size: 16px;
        font-weight: bold;
        color: #7b68ee;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .vote-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    /* Card selection area */
    .card-selection {
        width: 100%;
        padding: 20px;
        text-align: center;
    }
    
    .card-selection h3 {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 15px;
        color: #555;
    }
    
    .card-options {
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .card-option {
        width: 60px;
        height: 90px;
        background: white;
        border: none;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
        color: #7b68ee;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .card-option:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    
    .card-option.selected {
        background: #7b68ee;
        color: white;
        transform: translateY(-3px);
    }
    
    /* Right sidebar for stories */
    .stories-sidebar {
        width: 350px;
        background: white;
        border-left: 1px solid #eaeaea;
        padding: 20px;
        display: flex;
        flex-direction: column;
    }
    
    .story-search {
        position: relative;
        margin-bottom: 15px;
    }
    
    .story-search input {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid #eaeaea;
        border-radius: 8px;
        font-size: 14px;
        background: #f9f9f9;
    }
    
    .story-search button {
        position: absolute;
        right: 5px;
        top: 5px;
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 5px;
    }
    
    .story-card {
        background: white;
        border-radius: 8px;
        border: 1px solid #eaeaea;
        padding: 15px;
        margin-bottom: 15px;
        position: relative;
    }
    
    .story-status {
        display: inline-block;
        padding: 4px 8px;
        background: #7b68ee;
        color: white;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 10px;
    }
    
    .story-votes {
        font-size: 18px;
        font-weight: 600;
        margin: 15px 0;
    }
    
    .story-tag {
        display: flex;
        align-items: center;
        margin-top: 15px;
    }
    
    .story-tag button {
        background: none;
        border: none;
        color: #7b68ee;
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    
    .story-tag button span {
        margin-left: 5px;
    }
    
    .story-actions {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
    }
    
    .reset-button {
        display: flex;
        align-items: center;
        padding: 8px 15px;
        background: #f5f5f5;
        color: #555;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
    }
    
    .reset-button svg {
        margin-right: 5px;
    }
    
    .add-story-button {
        width: 100%;
        padding: 12px;
        background: white;
        border: 1px dashed #7b68ee;
        border-radius: 8px;
        color: #7b68ee;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin-top: 10px;
    }
    
    .add-story-button span {
        margin-right: 5px;
    }
    
    /* Card selection area at bottom */
    .card-selection-bottom {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        padding: 15px 0;
        z-index: 100;
    }
    
    .bottom-cards-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .bottom-cards-title {
        text-align: center;
        margin-bottom: 15px;
        font-size: 16px;
        font-weight: 700;
        color: #555;
    }
    
    .bottom-cards-options {
        display: flex;
        justify-content: center;
        gap: 10px;
    }
    
    /* Logo and header */
    .logo {
        display: flex;
        align-items: center;
    }
    
    .logo img {
        width: 30px;
        height: 30px;
        margin-right: 10px;
    }
    
    .logo span {
        font-size: 18px;
        font-weight: bold;
    }
    
    /* User info in header */
    .user-info {
        display: flex;
        align-items: center;
    }
    
    .avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #7b68ee;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        margin-right: 10px;
    }

    .username {
        font-weight: 500;
        margin-right: 15px;
    }
    
    .logout-button {
        background: transparent;
        border: none;
        color: #555;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
    }
    
    .logout-button span {
        margin-left: 5px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 1200px) {
        .app-container {
            flex-direction: column;
        }
        
        .participants-sidebar,
        .stories-sidebar {
            width: 100%;
            height: auto;
            border: none;
            border-bottom: 1px solid #eaeaea;
            padding: 10px;
        }
        
        .participants-list {
            flex-direction: row;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
        }
        
        .participant-item {
            min-width: 120px;
        }
        
        .voting-area {
            padding: 20px 10px;
        }
        
        .card-options,
        .bottom-cards-options {
            gap: 8px;
        }
        
        .card-option {
            width: 50px;
            height: 80px;
            font-size: 16px;
        }
    }
    
    @media (max-width: 768px) {
        .app-container {
            height: auto;
        }
        
        .voters-circle {
            height: 200px;
            width: 200px;
        }
        
        .center-instruction {
            width: 150px;
            font-size: 14px;
            padding: 10px 15px;
        }
        
        .card-option {
            width: 45px;
            height: 70px;
            font-size: 15px;
        }
        
        .voting-header {
            max-width: 90%;
        }
        
        .card-selection-bottom {
            padding: 10px 0;
        }
    }

    /* Planning cards section as fixed bottom */
    .planning-cards-section {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: white;
        border-top: 1px solid #e0e0e0;
        padding: 15px 0;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        z-index: 1000;
    }
    
    .planning-cards-section h3 {
        color: #673ab7;
        margin-bottom: 15px;
        font-size: 16px;
        font-weight: 700;
        text-align: center;
    }
    
    .cards {
        display: flex;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .card {
        width: 60px;
        height: 90px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: bold;
        color: #7b68ee;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        border-color: #7b68ee;
    }
    
    .card.selected {
        background: #7b68ee;
        color: white;
        border-color: #7b68ee;
    }

    /* Standard font sizes for revealed votes */
    body.votes-revealed .vote-badge,
    .vote-card-space.has-vote .vote-badge {
        font-size: 18px !important;
        font-weight: 600 !important;
        max-width: 80% !important;
        text-align: center !important;
        display: block !important;
        margin: auto !important;
        line-height: 1.2 !important;
    }
</style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="spade.png" alt="Planning Poker" />
            <span>Planning Poker</span>
        </div>
        <div class="user-info">
            <div class="avatar" id="headerUserAvatar">AN</div>
            <span class="username" id="headerUsername">User</span>
            <button class="logout-button" id="logOffBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 16L21 12M21 12L17 8M21 12H9M13 16V17C13 18.6569 11.6569 20 10 20H6C4.34315 20 3 18.6569 3 17V7C3 5.34315 4.34315 4 6 4H10C11.6569 4 13 5.34315 13 7V8" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Log Out</span>
            </button>
            <div class="connection-status" id="connectionStatus" title="Connected"></div>
        </div>
    </header>
    
    <div class="app-container">
        <!-- Left sidebar for participants -->
        <div class="participants-sidebar">
            <div class="participants-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4.354C12.5523 4.354 13 3.90628 13 3.354C13 2.80172 12.5523 2.354 12 2.354V4.354ZM12 2.354C11.4477 2.354 11 2.80172 11 3.354C11 3.90628 11.4477 4.354 12 4.354V2.354ZM19 12.354C19 16.2181 15.866 19.354 12 19.354V21.354C16.9706 21.354 21 17.3246 21 12.354H19ZM12 19.354C8.13401 19.354 5 16.2181 5 12.354H3C3 17.3246 7.02944 21.354 12 21.354V19.354ZM5 12.354C5 8.49003 8.13401 5.354 12 5.354V3.354C7.02944 3.354 3 7.37944 3 12.354H5ZM12 5.354C15.866 5.354 19 8.49003 19 12.354H21C21 7.37944 16.9706 3.354 12 3.354V5.354ZM12 2.354V5.354V2.354Z" fill="#555"/>
                </svg>
                <h3>Waiting</h3>
            </div>
            <div class="participants-list" id="userList">
                <!-- Participants will be generated here -->
                <div class="participant-item">
                    <div class="participant-avatar has-voted">AN</div>
                    <span class="participant-name">anandruban</span>
                </div>
                <div class="participant-item">
                    <div class="participant-avatar has-voted">JS</div>
                    <span class="participant-name">johndoe</span>
                    <div class="participant-vote">2</div>
                </div>
            </div>
        </div>
        
        <!-- Main voting area -->
        <div class="voting-area">
            <div class="voting-header">
                <div class="voting-count">Voting: 44</div>
            </div>
            
            <div class="voters-circle">
                <!-- Voter positions -->
                <div class="voter-marker">
                    <div class="participant-avatar has-voted">JS</div>
                </div>
                
                <div class="center-instruction">
                    Pick a card below
                </div>
                
                <!-- Vote cards will appear here when selected -->
                <div class="vote-marker" style="top: 60%; left: 50%; transform: translate(-50%, -50%);">
                    <div class="vote-button">2</div>
                </div>
            </div>
            
            <!-- Bottom choose card section -->
            <div class="card-selection">
                <h3>Choose your card</h3>
                <div class="card-options" id="planningCards">
                    <!-- Planning cards will be generated here -->
                    <button class="card-option">0</button>
                    <button class="card-option">1</button>
                    <button class="card-option selected">2</button>
                    <button class="card-option">3</button>
                    <button class="card-option">5</button>
                    <button class="card-option">8</button>
                    <button class="card-option">13</button>
                    <button class="card-option">21</button>
                    <button class="card-option">34</button>
                    <button class="card-option">55</button>
                    <button class="card-option">89</button>
                    <button class="card-option">☕</button>
                </div>
            </div>
        </div>
        
        <!-- Right sidebar for stories -->
        <div class="stories-sidebar" id="storyListContainer">
            <div class="story-search">
                <input type="text" placeholder="Search and filter tickets...">
                <button>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707v6.586a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            
            <div class="story-card">
                <div class="story-status">Pending</div>
                <span style="color: #888; font-size: 12px;">0 Votes</span>
                
                <div class="story-votes">44</div>
                
                <div class="story-tag">
                    <button>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Tag</span>
                    </button>
                </div>
                
                <div class="story-actions">
                    <button class="reset-button" id="resetVotesBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        RESET
                    </button>
                </div>
            </div>
            
            <button class="add-story-button" id="addTicketBtn">
                <span>+</span> ADD ANOTHER
            </button>
        </div>

        <!-- Modals -->
        <div id="inviteModalCustom" style="display: none;">
            <div class="modal-content">
                <h3>Invite Link</h3>
                <input id="inviteLinkCustom" readonly="" type="text"/>
                <div class="button-group">
                    <button onclick="copyInviteLinkCustom()">Copy Link</button>
                    <button onclick="hideInviteModalCustom()">Close</button>
                </div>
            </div>
        </div>
        
        <div id="loginModalCustom" style="display: none;">
            <div class="modal-content">
                <h3>Join Planning Poker Session</h3>
                <p>Please enter your name to join the session</p>
                <input id="userNameInput" type="text" placeholder="Your name" />
                <div class="button-group">
                    <button id="joinSessionWithName" class="action-button">Join Session</button>
                </div>
            </div>
        </div>
        
        <div id="addTicketModalCustom" style="display: none;">
            <div class="modal-content add-ticket-modal">
                <h3>Add New Ticket</h3>
                
                <div class="input-group">
                    <label for="ticketNameInput">Name</label>
                    <input id="ticketNameInput" type="text" placeholder="Enter ticket name">
                </div>
                
                <div class="input-group">
                    <label for="ticketDescriptionInput">Description</label>
                    <input id="ticketDescriptionInput" type="text" placeholder="Enter ticket description">
                </div>
                
                <div class="button-group">
                    <button id="cancelAddTicket" class="cancel-button">CANCEL</button>
                    <button id="confirmAddTicket" class="confirm-button">
                        <span class="plus-icon">+</span> ADD
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Planning cards section at fixed bottom -->
    <div class="planning-cards-section" id="fixedPlanningCards" style="display:none;">
        <h3>Choose your card</h3>
        <div class="cards" id="bottomPlanningCards">
            <!-- Cards will be dynamically generated -->
            <div class="card" data-value="0" draggable="true">0</div>
            <div class="card" data-value="1" draggable="true">1</div>
            <div class="card" data-value="2" draggable="true">2</div>
            <div class="card" data-value="3" draggable="true">3</div>
            <div class="card" data-value="5" draggable="true">5</div>
            <div class="card" data-value="8" draggable="true">8</div>
            <div class="card" data-value="13" draggable="true">13</div>
            <div class="card" data-value="21" draggable="true">21</div>
            <div class="card" data-value="34" draggable="true">34</div>
            <div class="card" data-value="55" draggable="true">55</div>
            <div class="card" data-value="89" draggable="true">89</div>
            <div class="card" data-value="☕" draggable="true">☕</div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize the user display in header
        initUserHeaderDisplay();
        
        // Set up the planning cards
        setupPlanningCards();
        
        // Attach event listeners to the card options
        setupCardOptionListeners();
        
        // Set up the log off button
        setupLogOffButton();
    });
    
    function initUserHeaderDisplay() {
        // Get username from session storage
        const username = sessionStorage.getItem('userName') || 'User';
        const usernameEl = document.getElementById('headerUsername');
        const avatarEl = document.getElementById('headerUserAvatar');
        
        if (usernameEl) {
            usernameEl.textContent = username;
        }
        
        if (avatarEl) {
            // Generate initials for the avatar
            const initials = username.split(' ')
                .map(part => part.charAt(0))
                .join('')
                .toUpperCase()
                .substring(0, 2);
                
            avatarEl.textContent = initials;
            
            // Generate a consistent color based on username
            const hue = Math.abs(username.split('').reduce((a, b) => {
                return a + b.charCodeAt(0);
            }, 0) % 360);
            
            avatarEl.style.backgroundColor = `hsl(${hue}, 70%, 60%)`;
        }
    }
    
    function setupPlanningCards() {
        const planningCardsContainer = document.getElementById('planningCards');
        const bottomPlanningCardsContainer = document.getElementById('bottomPlanningCards');
        
        if (!planningCardsContainer || !bottomPlanningCardsContainer) {
            return;
        }
        
        // Sync the two planning card containers
        const cardOptions = planningCardsContainer.querySelectorAll('.card-option');
        bottomPlanningCardsContainer.innerHTML = '';
        
        cardOptions.forEach(card => {
            const value = card.textContent;
            const newCard = document.createElement('div');
            newCard.className = 'card';
            newCard.setAttribute('data-value', value);
            newCard.setAttribute('draggable', 'true');
            newCard.textContent = value;
            
            // Add selection handling
            newCard.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                selectCard(value);
            });
            
            bottomPlanningCardsContainer.appendChild(newCard);
        });
    }
    
    function setupCardOptionListeners() {
        const cardOptions = document.querySelectorAll('.card-option');
        
        cardOptions.forEach(card => {
            card.addEventListener('click', function() {
                // Remove selected class from all cards
                cardOptions.forEach(c => c.classList.remove('selected'));
                
                // Add selected class to this card
                this.classList.add('selected');
                
                // Get the value of the card
                const value = this.textContent;
                
                // Also apply selection to bottom planning cards
                const bottomCards = document.querySelectorAll('#bottomPlanningCards .card');
                bottomCards.forEach(bottomCard => {
                    if (bottomCard.getAttribute('data-value') === value) {
                        bottomCard.classList.add('selected');
                    } else {
                        bottomCard.classList.remove('selected');
                    }
                });
                
                // Handle the vote
                handleVote(value);
            });
        });
    }
    
    function selectCard(value) {
        // Handle selection in fixed bottom planning cards
        const bottomCards = document.querySelectorAll('#bottomPlanningCards .card');
        bottomCards.forEach(card => {
            if (card.getAttribute('data-value') === value) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        });
        
        // Handle selection in main planning cards
        const cardOptions = document.querySelectorAll('.card-option');
        cardOptions.forEach(card => {
            if (card.textContent === value) {
                card.classList.add('selected');
            } else {
                card.classList.remove('selected');
            }
        });
        
        // Handle the vote
        handleVote(value);
    }
    
    function handleVote(value) {
        // Implement vote handling - Use the core functionality from main.js
        if (window.socket && typeof window.emitVote === 'function') {
            const userName = sessionStorage.getItem('userName');
            if (userName) {
                window.emitVote(value, userName);
            }
        } else {
            console.log('Voted: ' + value);
        }
    }
    
    function setupLogOffButton() {
        const logOffBtn = document.getElementById('logOffBtn');
        
        if (logOffBtn) {
            logOffBtn.addEventListener('click', function() {
                // Clear session storage
                sessionStorage.clear();
                
                // Redirect to main page
                window.location.href = 'main.html';
            });
        }
    }
    
    // Custom modal functions
    function showInviteModalCustom() {
        // Create a guest URL
        const currentUrl = new URL(window.location.href);
        const params = new URLSearchParams(currentUrl.search);
        const roomId = params.get('roomId');
        // Create clean guest URL (without host parameter)
        const guestUrl = `${currentUrl.origin}${currentUrl.pathname}?roomId=${roomId}`;
        
        document.getElementById('inviteLinkCustom').value = guestUrl;
        document.getElementById('inviteModalCustom').style.display = 'flex';
    }
    
    function hideInviteModalCustom() {
        document.getElementById('inviteModalCustom').style.display = 'none';
    }
    
    function copyInviteLinkCustom() {
        const inviteInput = document.getElementById('inviteLinkCustom');
        inviteInput.select();
        document.execCommand('copy');
        alert('Invite link copied!');
    }
    </script>
</body>
</html>
